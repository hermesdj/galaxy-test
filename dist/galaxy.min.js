/*! galaxy - v0.1.0 - 2014-02-19
 * https://github.com/hermesdj/galaxy
 * Copyright (c) Jeremy Dallard <dallardj@gmail.com> 2014 Licensed  
 */
"use strict";angular.module("galaxy",["monospaced.mousewheel"]),Date.prototype.getDOY=function(){var a=new Date(this.getFullYear(),0,1);return Math.ceil((this-a)/864e5)},angular.module("galaxy").controller("TestController",function(a){a.options={drawOrbits:!0,drawPlanets:!0,drawMoons:!0,drawMoonsOrbits:!0,zoom:{min:.2,max:7,current:1}},a.system={star:{name:"Sol",radius:20,color:"yellow",orbits:[{name:"Mercury",distance:58,period:88,color:"maroon",size:2,startAngle:1.5},{name:"Venus",distance:108,period:224,color:"purple",size:7,startAngle:1},{name:"Earth",distance:149,color:"blue",size:5,period:365,startAngle:.7,orbits:[{name:"Moon",distance:6.38,period:27.32,color:"gray",size:1,startAngle:1}]},{name:"Mars",distance:227,color:"red",size:3,period:686,startAngle:3,orbits:[{name:"Phobos",distance:4.09,size:.3,period:.32,startAngle:2},{name:"Deimos",distance:5.23,size:.6,period:1.26,startAngle:.7}]},{name:"Jupiter",distance:778,period:4332,color:"orange",size:15,startAngle:2},{name:"Saturn",distance:1429,color:"midnightblue",period:10759,size:10,startAngle:.7},{name:"Uranus",distance:2870,period:30685,size:5,color:"black",startAngle:5.7},{name:"Neptune",distance:4504,period:60190,size:4,color:"lightseagreen",startAngle:1.3},{name:"Pluto",distance:5913,period:90550,size:1,color:"lightgreen",startAngle:1.8}]}}}),angular.module("galaxy").directive("galaxySystem",function(a,b){return{restrict:"EA",templateUrl:"templates/system.html",replace:!0,link:function(c){function d(){b.unbind("mousemove",e),b.unbind("mouseup",d)}function e(a){var b=a.pageY-i,d=a.pageX-h;c.move(d,b)}function f(a){if(a.orbitalSpeed=Math.round(36e3/a.period)/100,a.orbits)for(var b in a.orbits)f(a.orbits[b])}function g(){var a=1;c.d+=a,c.date.setDate(c.date.getDate()+a)}c.date=new Date,c.doy=c.date.getDOY(),c.d=c.doy;var h=500,i=400;c.mousedown=function(a){a.preventDefault(),h=a.pageX-c.x,i=a.pageY-c.y,b.on("mousemove",e),b.on("mouseup",d)},c.move=function(a,b){c.y=b,c.x=a},c.zoom=function(a,b){if(0>b){if(c.z<=c.options.zoom.min)return;c.z<=1?c.z*=.5:c.z+=b}else{if(c.z>=c.options.zoom.max)return;c.z<=1?c.z*=2:c.z+=b}},c.x=h,c.y=i,c.z=1;for(var j in c.system.star.orbits)f(c.system.star.orbits[j]);c.stop=a(g,100),c.current=null,c.select=function(a){c.current=a},c.pause=function(){angular.isDefined(c.stop)?(a.cancel(c.stop),c.stop=void 0):c.stop=a(g,100)},c.$on("$destroy",function(){angular.isDefined(c.stop)&&(a.cancel(c.stop),c.stop=void 0)}),c.getRotation=function(a){return c.d*a.orbitalSpeed+a.startAngle}}}}),angular.module("hyperdrive",["hyperdrive.starmap"]),angular.module("hyperdrive.starmap",["monospaced.mousewheel"]),Date.prototype.getDOY=function(){var a=new Date(this.getFullYear(),0,1);return Math.ceil((this-a)/864e5)},angular.module("hyperdrive.starmap").controller("MapController",function(a,b){a.mapLevel=3,a.zoomLevel=1,a.zoomPosition={x:0,y:0},a.debug=!0,a.center={x:b.innerWidth/2,y:b.innerHeight/2};var c=10;a.zoom=function(b,d){a.zoomLevel+=d,a.zoomPosition={x:b.clientX,y:b.clientY},a.zoomLevel<=0&&(a.mapLevel<=1?a.zoomLevel=1:(a.zoomLevel=c,a.mapLevel-=1)),a.zoomLevel>c&&(a.mapLevel>=4?a.zoomLevel=c:(a.zoomLevel=1,a.mapLevel+=1)),a.mapLevel<=1&&(a.mapLevel=1),a.mapLevel>=4&&(a.mainZoomLebel=4)},a.system={star:{name:"Sol",radius:20,color:"yellow",orbits:[{name:"Mercury",distance:58,period:88,color:"maroon",size:2,startAngle:1.5},{name:"Venus",distance:108,period:224,color:"purple",size:7,startAngle:1},{name:"Earth",distance:149,color:"blue",size:5,period:365,startAngle:.7,orbits:[{name:"Moon",distance:6.38,period:27.32,color:"gray",size:1,startAngle:1}]},{name:"Mars",distance:227,color:"red",size:3,period:686,startAngle:3,orbits:[{name:"Phobos",distance:4.09,size:.3,period:.32,startAngle:2},{name:"Deimos",distance:5.23,size:.6,period:1.26,startAngle:.7}]}]}}}),angular.module("hyperdrive.starmap").directive("starSystem",function(a,b){return{restrict:"EA",templateUrl:"templates/system.html",replace:!0,scope:{zoomLevel:"=",system:"=",center:"="},link:function(c){function d(){b.unbind("mousemove",e),b.unbind("mouseup",d)}function e(a){var b=a.pageY-i,d=a.pageX-h;c.move(d,b)}function f(a){if(a.orbitalSpeed=Math.round(36e3/a.period)/100,a.orbits)for(var b in a.orbits)f(a.orbits[b])}function g(){var a=1;c.d+=a,c.date.setDate(c.date.getDate()+a)}c.date=new Date,c.doy=c.date.getDOY(),c.d=c.doy;var h=c.center.x,i=c.center.y;c.mousedown=function(a){a.preventDefault(),h=a.pageX-c.x,i=a.pageY-c.y,b.on("mousemove",e),b.on("mouseup",d)},c.move=function(a,b){c.y=b,c.x=a},c.getScale=function(){return c.zoomLevel},c.x=h,c.y=i;for(var j in c.system.star.orbits)f(c.system.star.orbits[j]);c.stop=a(g,100),c.current=null,c.select=function(a){c.current=a},c.pause=function(){angular.isDefined(c.stop)?(a.cancel(c.stop),c.stop=void 0):c.stop=a(g,100)},c.$on("$destroy",function(){angular.isDefined(c.stop)&&(a.cancel(c.stop),c.stop=void 0)}),c.getRotation=function(a){return c.d*a.orbitalSpeed+a.startAngle}}}});var Pixastic=function(){function a(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,c)}function b(b){var c=!1,d=function(){c||(c=!0,b())};document.write('<script defer src="//:" id="__onload_ie_pixastic__"></script>');var e=document.getElementById("__onload_ie_pixastic__");e.onreadystatechange=function(){"complete"==e.readyState&&(e.parentNode.removeChild(e),d())},document.addEventListener&&document.addEventListener("DOMContentLoaded",d,!1),a(window,"load",d)}function c(){for(var a=d("pixastic",null,"img"),b=d("pixastic",null,"canvas"),c=a.concat(b),e=0;e<c.length;e++)!function(){for(var a=c[e],b=[],d=a.className.split(" "),f=0;f<d.length;f++){var g=d[f];if("pixastic-"==g.substring(0,9)){var h=g.substring(9);""!=h&&b.push(h)}}if(b.length)if("img"==a.tagName.toLowerCase()){var i=new Image;if(i.src=a.src,i.complete)for(var j=0;j<b.length;j++){var k=Pixastic.applyAction(a,a,b[j],null);k&&(a=k)}else i.onload=function(){for(var c=0;c<b.length;c++){var d=Pixastic.applyAction(a,a,b[c],null);d&&(a=d)}}}else setTimeout(function(){for(var c=0;c<b.length;c++){var d=Pixastic.applyAction(a,a,b[c],null);d&&(a=d)}},1)}()}function d(a,b,c){var d=new Array;null==b&&(b=document),null==c&&(c="*");var e=b.getElementsByTagName(c),f=e.length,g=new RegExp("(^|\\s)"+a+"(\\s|$)");for(i=0,j=0;f>i;i++)g.test(e[i].className)&&(d[j]=e[i],j++);return d}function e(a,b){if(Pixastic.debug)try{switch(b){case"warn":console.warn("Pixastic:",a);break;case"error":console.error("Pixastic:",a);break;default:console.log("Pixastic:",a)}}catch(c){}}"undefined"!=typeof pixastic_parseonload&&pixastic_parseonload&&b(c);var f=function(){var a=document.createElement("canvas"),b=!1;try{b=!("function"!=typeof a.getContext||!a.getContext("2d"))}catch(c){}return function(){return b}}(),g=function(){var a,b=document.createElement("canvas"),c=!1;try{"function"==typeof b.getContext&&(a=b.getContext("2d"))&&(c="function"==typeof a.getImageData)}catch(d){}return function(){return c}}(),h=function(){var a=!1,b=document.createElement("canvas");if(f()&&g()){b.width=b.height=1;var c=b.getContext("2d");c.fillStyle="rgb(255,0,0)",c.fillRect(0,0,1,1);var d=document.createElement("canvas");d.width=d.height=1;var e=d.getContext("2d");e.fillStyle="rgb(0,0,255)",e.fillRect(0,0,1,1),c.globalAlpha=.5,c.drawImage(d,0,0);var h=c.getImageData(0,0,1,1).data;a=255!=h[2]}return function(){return a}}();return{parseOnLoad:!1,debug:!1,applyAction:function(a,b,c,d){d=d||{};var f="canvas"==a.tagName.toLowerCase();if(f&&Pixastic.Client.isIE())return Pixastic.debug&&e("Tried to process a canvas element but browser is IE."),!1;var g,h,i=!1;Pixastic.Client.hasCanvas()&&(i=!!d.resultCanvas,g=d.resultCanvas||document.createElement("canvas"),h=g.getContext("2d"));var j=a.offsetWidth,k=a.offsetHeight;if(f&&(j=a.width,k=a.height),0==j||0==k){if(null!=a.parentNode)return void(Pixastic.debug&&e("Image has 0 width and/or height."));var l=a.style.position,m=a.style.left;a.style.position="absolute",a.style.left="-9999px",document.body.appendChild(a),j=a.offsetWidth,k=a.offsetHeight,document.body.removeChild(a),a.style.position=l,a.style.left=m}if(c.indexOf("(")>-1){var n=c;c=n.substr(0,n.indexOf("("));var o=n.match(/\((.*?)\)/);if(o[1]){o=o[1].split(";");for(var p=0;p<o.length;p++)if(thisArg=o[p].split("="),2==thisArg.length)if("rect"==thisArg[0]){var q=thisArg[1].split(",");d[thisArg[0]]={left:parseInt(q[0],10)||0,top:parseInt(q[1],10)||0,width:parseInt(q[2],10)||0,height:parseInt(q[3],10)||0}}else d[thisArg[0]]=thisArg[1]}}d.rect?(d.rect.left=Math.round(d.rect.left),d.rect.top=Math.round(d.rect.top),d.rect.width=Math.round(d.rect.width),d.rect.height=Math.round(d.rect.height)):d.rect={left:0,top:0,width:j,height:k};var r=!1;if(Pixastic.Actions[c]&&"function"==typeof Pixastic.Actions[c].process&&(r=!0),!r)return Pixastic.debug&&e('Invalid action "'+c+'". Maybe file not included?'),!1;if(!Pixastic.Actions[c].checkSupport())return Pixastic.debug&&e('Action "'+c+'" not supported by this browser.'),!1;Pixastic.Client.hasCanvas()?(g!==a&&(g.width=j,g.height=k),i||(g.style.width=j+"px",g.style.height=k+"px"),h.drawImage(b,0,0,j,k),a.__pixastic_org_image?(g.__pixastic_org_image=a.__pixastic_org_image,g.__pixastic_org_width=a.__pixastic_org_width,g.__pixastic_org_height=a.__pixastic_org_height):(g.__pixastic_org_image=a,g.__pixastic_org_width=j,g.__pixastic_org_height=k)):Pixastic.Client.isIE()&&"undefined"==typeof a.__pixastic_org_style&&(a.__pixastic_org_style=a.style.cssText);var s={image:a,canvas:g,width:j,height:k,useData:!0,options:d},t=Pixastic.Actions[c].process(s);return t?Pixastic.Client.hasCanvas()?(s.useData&&Pixastic.Client.hasCanvasImageData()&&(g.getContext("2d").putImageData(s.canvasData,d.rect.left,d.rect.top),g.getContext("2d").fillRect(0,0,0,0)),d.leaveDOM||(g.title=a.title,g.imgsrc=a.imgsrc,f||(g.alt=a.alt),f||(g.imgsrc=a.src),g.className=a.className,g.style.cssText=a.style.cssText,g.name=a.name,g.tabIndex=a.tabIndex,g.id=a.id,a.parentNode&&a.parentNode.replaceChild&&a.parentNode.replaceChild(g,a)),d.resultCanvas=g,g):a:!1},prepareData:function(a,b){var c=a.canvas.getContext("2d"),d=a.options.rect,e=c.getImageData(d.left,d.top,d.width,d.height),f=e.data;return b||(a.canvasData=e),f},process:function(a,b,c,d){if("img"==a.tagName.toLowerCase()){var e=new Image;if(e.src=a.src,e.complete){var f=Pixastic.applyAction(a,e,b,c);return d&&d(f),f}e.onload=function(){var f=Pixastic.applyAction(a,e,b,c);d&&d(f)}}if("canvas"==a.tagName.toLowerCase()){var f=Pixastic.applyAction(a,a,b,c);return d&&d(f),f}},revert:function(a){if(Pixastic.Client.hasCanvas()){if("canvas"==a.tagName.toLowerCase()&&a.__pixastic_org_image)return a.width=a.__pixastic_org_width,a.height=a.__pixastic_org_height,a.getContext("2d").drawImage(a.__pixastic_org_image,0,0),a.parentNode&&a.parentNode.replaceChild&&a.parentNode.replaceChild(a.__pixastic_org_image,a),a}else Pixastic.Client.isIE()&&"undefined"!=typeof a.__pixastic_org_style&&(a.style.cssText=a.__pixastic_org_style)},Client:{hasCanvas:f,hasCanvasImageData:g,hasGlobalAlpha:h,isIE:function(){return!!document.all&&!!window.attachEvent&&!window.opera}},Actions:{}}}();Pixastic.Actions.desaturate={process:function(a){var b=!(!a.options.average||"false"==a.options.average);if(Pixastic.Client.hasCanvasImageData()){var c,d,e=Pixastic.prepareData(a),f=a.options.rect,g=f.width,h=f.height,i=g*h,j=4*i;if(b)for(;i--;)e[j-=4]=e[c=j+1]=e[d=j+2]=(e[j]+e[c]+e[d])/3;else for(;i--;)e[j-=4]=e[c=j+1]=e[d=j+2]=.3*e[j]+.59*e[c]+.11*e[d];return!0}return Pixastic.Client.isIE()?(a.image.style.filter+=" gray",!0):void 0},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()||Pixastic.Client.isIE()}},Pixastic.Actions.histogram={process:function(a){var b=!(!a.options.average||"false"==a.options.average),c=!(!a.options.paint||"false"==a.options.paint),d=a.options.color||"rgba(255,255,255,0.5)",e=[];"object"!=typeof a.options.returnValue&&(a.options.returnValue={values:[]});var f=a.options.returnValue;if("array"!=typeof f.values&&(f.values=[]),e=f.values,Pixastic.Client.hasCanvasImageData()){var g=Pixastic.prepareData(a);a.useData=!1;for(var h=0;256>h;h++)e[h]=0;var i=a.options.rect,j=i.width*i.height,k=4*j,l=Math.round;if(b)for(;j--;)e[l((g[k-=4]+g[k+1]+g[k+2])/3)]++;else for(;j--;)e[l(.3*g[k-=4]+.59*g[k+1]+.11*g[k+2])]++;if(c){for(var m=0,h=0;256>h;h++)e[h]>m&&(m=e[h]);var n=a.height/m,o=a.width/256,p=a.canvas.getContext("2d");p.fillStyle=d;for(var h=0;256>h;h++)p.fillRect(h*o,a.height-n*e[h],o,e[h]*n)}return f.values=e,!0}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}},Pixastic.Actions.laplace={process:function(a){var b=!(!a.options.invert||"false"==a.options.invert),c=parseFloat(a.options.edgeStrength)||0,d=parseInt(a.options.greyLevel)||0;if(c=-c,Pixastic.Client.hasCanvasImageData()){var e=Pixastic.prepareData(a),f=Pixastic.prepareData(a,!0),g=1/8,h=a.options.rect,i=h.width,j=h.height,k=4*i,l=j;do{var m=(l-1)*k,n=l==j?l-1:l,o=1==l?0:l-2,p=o*i*4,q=n*i*4,r=i;do{var s=m+(4*r-4),t=p+4*(1==r?0:r-2),u=q+4*(r==i?r-1:r),v=(-f[t-4]-f[t]-f[t+4]-f[s-4]-f[s+4]-f[u-4]-f[u]-f[u+4]+8*f[s])*g,w=(-f[t-3]-f[t+1]-f[t+5]-f[s-3]-f[s+5]-f[u-3]-f[u+1]-f[u+5]+8*f[s+1])*g,x=(-f[t-2]-f[t+2]-f[t+6]-f[s-2]-f[s+6]-f[u-2]-f[u+2]-f[u+6]+8*f[s+2])*g,y=(v+w+x)/3+d;0!=c&&(y>127?y+=(y+1-128)*c:127>y&&(y-=(y+1)*c)),b&&(y=255-y),0>y&&(y=0),y>255&&(y=255),e[s]=e[s+1]=e[s+2]=y}while(--r)}while(--l);return!0}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}},angular.module("galaxy").controller("GalaxyGeneratorController",function(a){function b(a,b,c,d,e){for(var f=[],g=0;a>g;g++){for(var h=[],i=0;a>i;i++){var j=d/a,k=e/a,l=g*j,m=i*k;h.push({dx:l,dy:m,width:j,height:k})}f.push(h)}return f}function c(a,b,c){for(var d=a.getImageData(b.dx,b.dy,b.width,b.height),e=0,f=0;f<d.data.length;f+=4)e+=3*d.data[f];e=Math.ceil(e/d.data.length);for(var g in c){var h=c[g];e>=h.min&&e<=h.max&&(b.level=g)}}function d(a,b,c){for(var d=0;d<b.length;d++)for(var e=b[d],f=0;f<e.length;f++){var g=e[f];void 0!==c[g.level]&&(a.fillStyle=c[g.level].color,a.fillRect(g.dx,g.dy,g.width,g.height))}}a.q=400;var e=document.getElementById("canvas"),f=e.getContext("2d"),g=document.getElementById("milky");e.width=g.width,e.height=g.height,a.options=[{min:30,max:70,color:"#00162D"},{min:70,max:90,color:"#002B56"},{min:90,max:105,color:"#033E82"},{min:105,max:125,color:"#0353AA"},{min:125,max:255,color:"#116ABC"}];var h=document.getElementById("result"),i=h.getContext("2d");h.width=e.width,h.height=e.height,a.analyse=function(){var h=(new Date).getTime();g=Pixastic.process(g,"desaturate",{average:!0}),a.time=(new Date).getTime()-h,f.clearRect(0,0,e.width,e.height),f.drawImage(g,0,0,e.width,e.height),f.textAlign="center",f.textBaseline="middle",f.strokeStyle="white",f.fillStyle="white";var j=b(a.q,0,0,e.width,e.height,!0);for(var k in j){var l=j[k];for(var m in l){var n=l[m];c(f,n,a.options,!1)}}Pixastic.revert(g),i.fillStyle="black",i.fillRect(0,0,e.width,e.height),i.globalAlpha=1,d(i,j,a.options),a.time=(new Date).getTime()-h},a.analyse()});